<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Br√•k√§ventyret - Matematikspel f√∂r √•k 7</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Poppins:wght@500;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #FF6B35;
            --secondary: #F7931E;
            --accent: #4ECDC4;
            --success: #2ECC71;
            --error: #E74C3C;
            --bg-main: #FFF8F0;
            --bg-card: #FFFFFF;
            --text-dark: #2C3E50;
            --text-light: #7F8C8D;
        }
        
        body {
            font-family: 'Fredoka', cursive;
            background: linear-gradient(135deg, #FFF8F0 0%, #FFE5D9 100%);
            min-height: 100vh;
            color: var(--text-dark);
            overflow-x: hidden;
            position: relative;
        }
        
        /* Animated background */
        .bg-decoration {
            position: fixed;
            pointer-events: none;
            opacity: 0.08;
            z-index: 0;
        }
        
        .bg-circle {
            position: absolute;
            border-radius: 50%;
        }
        
        .bg-circle-1 {
            width: 300px;
            height: 300px;
            top: -100px;
            right: -50px;
            background: var(--primary);
            animation: float 20s infinite ease-in-out;
        }
        
        .bg-circle-2 {
            width: 200px;
            height: 200px;
            bottom: -50px;
            left: -50px;
            background: var(--accent);
            animation: float 15s infinite ease-in-out reverse;
        }
        
        .bg-circle-3 {
            width: 150px;
            height: 150px;
            top: 50%;
            left: 10%;
            background: var(--secondary);
            animation: float 18s infinite ease-in-out;
        }
        
        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(120deg); }
            66% { transform: translate(-20px, 20px) rotate(240deg); }
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            animation: slideDown 0.6s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 3.2em;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            letter-spacing: -1px;
        }
        
        .subtitle {
            font-size: 1.1em;
            color: var(--text-light);
            font-weight: 400;
        }
        
        /* Screens */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }
        
        .screen.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        
        /* Cards */
        .card {
            background: var(--bg-card);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .card h2 {
            font-size: 2em;
            color: var(--primary);
            margin-bottom: 20px;
            font-family: 'Poppins', sans-serif;
        }
        
        /* Player selection */
        .player-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }
        
        .player-btn {
            background: linear-gradient(135deg, var(--accent), #3DA9A3);
            border: 3px solid transparent;
            border-radius: 20px;
            padding: 30px;
            font-family: 'Fredoka', cursive;
            font-size: 1.4em;
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(78, 205, 196, 0.3);
        }
        
        .player-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(78, 205, 196, 0.4);
        }
        
        .player-btn.selected {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.4);
            border-color: var(--primary);
        }
        
        .player-btn span {
            display: block;
            font-size: 3em;
            margin-bottom: 10px;
        }
        
        /* Buttons */
        .btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 15px;
            padding: 18px 40px;
            font-family: 'Fredoka', cursive;
            font-size: 1.3em;
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.3);
            display: inline-block;
            text-align: center;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.4);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--accent), #3DA9A3);
            box-shadow: 0 5px 15px rgba(78, 205, 196, 0.3);
        }
        
        .btn-secondary:hover {
            box-shadow: 0 8px 25px rgba(78, 205, 196, 0.4);
        }
        
        .btn-center {
            display: block;
            margin: 30px auto 0;
        }
        
        /* Instructions */
        .instructions {
            background: linear-gradient(135deg, #FFF3E0, #FFE0B2);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid var(--secondary);
        }
        
        .instructions h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        .instructions ul {
            list-style: none;
            padding: 0;
        }
        
        .instructions li {
            padding: 8px 0;
            padding-left: 30px;
            position: relative;
        }
        
        .instructions li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: var(--success);
            font-weight: bold;
            font-size: 1.3em;
        }
        
        .example {
            background: #E8F5E9;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid var(--success);
        }
        
        .example h4 {
            color: var(--success);
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        .example-calc {
            font-family: 'Poppins', monospace;
            font-size: 1.3em;
            color: var(--text-dark);
            line-height: 1.8;
        }
        
        /* Game area */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .score-board {
            background: linear-gradient(135deg, var(--accent), #3DA9A3);
            color: white;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 1.2em;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(78, 205, 196, 0.3);
        }
        
        .current-player {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 1.2em;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.3);
        }
        
        .challenge-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin: 30px 0;
        }
        
        .challenge-type {
            background: var(--accent);
            color: white;
            display: inline-block;
            padding: 10px 25px;
            border-radius: 20px;
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 25px;
        }
        
        .challenge-question {
            font-size: 2.5em;
            font-weight: 700;
            color: var(--text-dark);
            margin: 30px 0;
            font-family: 'Poppins', sans-serif;
        }
        
        .fraction {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            margin: 0 10px;
            vertical-align: middle;
        }
        
        .numerator {
            padding-bottom: 5px;
            border-bottom: 3px solid var(--text-dark);
        }
        
        .denominator {
            padding-top: 5px;
        }
        
        /* Answer options */
        .answer-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }
        
        .answer-btn {
            background: white;
            border: 3px solid var(--accent);
            border-radius: 15px;
            padding: 25px;
            font-family: 'Fredoka', cursive;
            font-size: 1.8em;
            font-weight: 600;
            color: var(--text-dark);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .answer-btn:hover {
            background: var(--accent);
            color: white;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(78, 205, 196, 0.3);
        }
        
        .answer-btn.correct {
            background: var(--success);
            border-color: var(--success);
            color: white;
            animation: pulse 0.5s ease;
        }
        
        .answer-btn.incorrect {
            background: var(--error);
            border-color: var(--error);
            color: white;
            animation: shake 0.5s ease;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        /* Input answers */
        .answer-input-area {
            margin: 30px 0;
        }
        
        .fraction-input {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            margin: 0 20px;
        }
        
        .fraction-input input {
            width: 100px;
            padding: 15px;
            font-size: 2em;
            text-align: center;
            border: 3px solid var(--accent);
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
        }
        
        .fraction-input input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .fraction-line {
            width: 100px;
            height: 3px;
            background: var(--text-dark);
            margin: 10px 0;
        }
        
        /* Feedback */
        .feedback {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            text-align: center;
            font-size: 1.3em;
            font-weight: 600;
            display: none;
        }
        
        .feedback.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .feedback.success {
            background: linear-gradient(135deg, #D4EDDA, #C3E6CB);
            color: #155724;
            border: 3px solid var(--success);
        }
        
        .feedback.error {
            background: linear-gradient(135deg, #F8D7DA, #F5C6CB);
            color: #721C24;
            border: 3px solid var(--error);
        }
        
        .feedback-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }
        
        /* Special card */
        .special-card {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border: 3px solid #FF8C00;
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
            animation: sparkle 2s infinite;
        }
        
        .special-card h3 {
            color: white;
            font-size: 1.8em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }
        
        .special-card p {
            color: white;
            font-size: 1.2em;
            font-weight: 600;
        }
        
        @keyframes sparkle {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.8); }
        }
        
        /* Winner screen */
        .winner-announcement {
            text-align: center;
            padding: 40px;
        }
        
        .trophy {
            font-size: 6em;
            animation: bounce 1s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .winner-text {
            font-size: 3em;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 20px 0;
        }
        
        .final-score {
            font-size: 2em;
            color: var(--text-dark);
            margin: 20px 0;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.5em;
            }
            
            .challenge-question {
                font-size: 2em;
            }
            
            .answer-options {
                grid-template-columns: 1fr;
            }
            
            .game-header {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Background decoration -->
    <div class="bg-decoration">
        <div class="bg-circle bg-circle-1"></div>
        <div class="bg-circle bg-circle-2"></div>
        <div class="bg-circle bg-circle-3"></div>
    </div>

    <div class="container">
        <header>
            <h1>üßÆ Br√•k√§ventyret</h1>
            <p class="subtitle">Matematikspel f√∂r √•k 7</p>
        </header>

        <!-- Start Screen -->
        <div id="startScreen" class="screen active">
            <div class="card">
                <h2>V√§lkommen till Br√•k√§ventyret!</h2>
                
                <div class="instructions">
                    <h3>üìã Hur spelet fungerar</h3>
                    <ul>
                        <li>V√§lj 1 eller 2 spelare</li>
                        <li>Svara p√• br√•kfr√•gor f√∂r att samla po√§ng</li>
                        <li>R√§tt svar ger 10 po√§ng</li>
                        <li>Fel svar ger 0 po√§ng</li>
                        <li>F√∂rsta till 50 po√§ng vinner!</li>
                        <li>Ibland f√•r du ett ‚≠ê SPECIALKORT som ger bonuspo√§ng!</li>
                    </ul>
                </div>

                <div class="example">
                    <h4>üìñ Exempel p√• addition av br√•k:</h4>
                    <div class="example-calc">
                        3/4 + 1/8 = ?<br>
                        ‚Üí Gemensam n√§mnare: 8<br>
                        ‚Üí 6/8 + 1/8 = 7/8<br>
                        ‚úì R√§tt svar: 7/8
                    </div>
                </div>

                <h3 style="margin-top: 30px; margin-bottom: 15px;">V√§lj antal spelare:</h3>
                <div class="player-selection">
                    <button class="player-btn" onclick="selectPlayers(1)">
                        <span>üë§</span>
                        1 Spelare
                    </button>
                    <button class="player-btn" onclick="selectPlayers(2)">
                        <span>üë•</span>
                        2 Spelare
                    </button>
                </div>

                <button class="btn btn-center" onclick="startGame()" id="startBtn" style="display: none;">
                    Starta spelet! üöÄ
                </button>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="screen">
            <div class="game-header">
                <div class="score-board" id="scoreBoard">
                    Spelare 1: 0p | Spelare 2: 0p
                </div>
                <div class="current-player" id="currentPlayer">
                    Spelare 1:s tur
                </div>
            </div>

            <div id="specialCardArea"></div>

            <div class="challenge-card">
                <div class="challenge-type" id="challengeType">J√§mf√∂r br√•k</div>
                <div class="challenge-question" id="challengeQuestion"></div>
                <div id="answerArea"></div>
            </div>

            <div class="feedback" id="feedback">
                <div class="feedback-icon" id="feedbackIcon"></div>
                <div id="feedbackText"></div>
            </div>

            <button class="btn btn-center" id="nextBtn" onclick="nextTurn()" style="display: none;">
                N√§sta tur ‚Üí
            </button>
        </div>

        <!-- Winner Screen -->
        <div id="winnerScreen" class="screen">
            <div class="card">
                <div class="winner-announcement">
                    <div class="trophy">üèÜ</div>
                    <div class="winner-text" id="winnerText">Grattis!</div>
                    <div class="final-score" id="finalScore"></div>
                    <button class="btn btn-center" onclick="resetGame()">
                        Spela igen üîÑ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game state
        let gameState = {
            numPlayers: 0,
            currentPlayer: 0,
            scores: [0, 0],
            currentChallenge: null,
            answered: false,
            turnCount: 0
        };

        // Challenge types
        const challengeTypes = {
            COMPARE: 'compare',
            ADD: 'add',
            SUBTRACT: 'subtract',
            SIMPLIFY: 'simplify'
        };

        // Select number of players
        function selectPlayers(num) {
            gameState.numPlayers = num;
            
            // Update button styles
            const buttons = document.querySelectorAll('.player-btn');
            buttons.forEach((btn, index) => {
                if (index === num - 1) {
                    btn.classList.add('selected');
                } else {
                    btn.classList.remove('selected');
                }
            });
            
            // Show start button
            document.getElementById('startBtn').style.display = 'block';
        }

        // Start game
        function startGame() {
            if (gameState.numPlayers === 0) {
                alert('V√§lj antal spelare f√∂rst!');
                return;
            }
            
            showScreen('gameScreen');
            gameState.currentPlayer = 0;
            gameState.scores = [0, 0];
            gameState.turnCount = 0;
            updateScoreBoard();
            generateChallenge();
        }

        // Show screen
        function showScreen(screenId) {
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => screen.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        // Generate random fraction
        function generateFraction(maxNum = 10, maxDen = 12) {
            const numerator = Math.floor(Math.random() * maxNum) + 1;
            const denominator = Math.floor(Math.random() * maxDen) + 2;
            return { numerator, denominator };
        }

        // GCD for simplification
        function gcd(a, b) {
            return b === 0 ? a : gcd(b, a % b);
        }

        // Simplify fraction
        function simplifyFraction(num, den) {
            const divisor = gcd(Math.abs(num), Math.abs(den));
            return {
                numerator: num / divisor,
                denominator: den / divisor
            };
        }

        // Compare fractions
        function compareFractions(frac1, frac2) {
            const val1 = frac1.numerator / frac1.denominator;
            const val2 = frac2.numerator / frac2.denominator;
            return val1 - val2;
        }

        // Generate challenge
        function generateChallenge() {
            // Reset state
            gameState.answered = false;
            document.getElementById('feedback').classList.remove('show');
            document.getElementById('nextBtn').style.display = 'none';
            
            // Check for special card (20% chance every 3 turns)
            if (gameState.turnCount > 0 && gameState.turnCount % 3 === 0 && Math.random() < 0.3) {
                showSpecialCard();
            } else {
                document.getElementById('specialCardArea').innerHTML = '';
            }
            
            // Random challenge type
            const types = [challengeTypes.COMPARE, challengeTypes.ADD, challengeTypes.SUBTRACT, challengeTypes.SIMPLIFY];
            const type = types[Math.floor(Math.random() * types.length)];
            
            switch(type) {
                case challengeTypes.COMPARE:
                    generateCompareChallenge();
                    break;
                case challengeTypes.ADD:
                    generateAddChallenge();
                    break;
                case challengeTypes.SUBTRACT:
                    generateSubtractChallenge();
                    break;
                case challengeTypes.SIMPLIFY:
                    generateSimplifyChallenge();
                    break;
            }
        }

        // Compare challenge
        function generateCompareChallenge() {
            const frac1 = generateFraction(8, 10);
            const frac2 = generateFraction(8, 10);
            
            gameState.currentChallenge = {
                type: challengeTypes.COMPARE,
                frac1: frac1,
                frac2: frac2,
                correctAnswer: compareFractions(frac1, frac2) > 0 ? 'frac1' : 'frac2'
            };
            
            document.getElementById('challengeType').textContent = 'üîç J√§mf√∂r br√•k';
            document.getElementById('challengeQuestion').innerHTML = `
                Vilket br√•k √§r st√∂rst?
            `;
            
            document.getElementById('answerArea').innerHTML = `
                <div class="answer-options">
                    <button class="answer-btn" onclick="checkCompareAnswer('frac1')">
                        <div class="fraction">
                            <div class="numerator">${frac1.numerator}</div>
                            <div class="denominator">${frac1.denominator}</div>
                        </div>
                    </button>
                    <button class="answer-btn" onclick="checkCompareAnswer('frac2')">
                        <div class="fraction">
                            <div class="numerator">${frac2.numerator}</div>
                            <div class="denominator">${frac2.denominator}</div>
                        </div>
                    </button>
                </div>
            `;
        }

        // Add challenge
        function generateAddChallenge() {
            const frac1 = generateFraction(5, 8);
            const frac2 = generateFraction(5, 8);
            
            // Calculate answer
            const commonDen = frac1.denominator * frac2.denominator / gcd(frac1.denominator, frac2.denominator);
            const num1 = frac1.numerator * (commonDen / frac1.denominator);
            const num2 = frac2.numerator * (commonDen / frac2.denominator);
            const resultNum = num1 + num2;
            
            const simplified = simplifyFraction(resultNum, commonDen);
            
            gameState.currentChallenge = {
                type: challengeTypes.ADD,
                frac1: frac1,
                frac2: frac2,
                correctAnswer: simplified
            };
            
            document.getElementById('challengeType').textContent = '‚ûï Addition';
            document.getElementById('challengeQuestion').innerHTML = `
                <div class="fraction">
                    <div class="numerator">${frac1.numerator}</div>
                    <div class="denominator">${frac1.denominator}</div>
                </div>
                +
                <div class="fraction">
                    <div class="numerator">${frac2.numerator}</div>
                    <div class="denominator">${frac2.denominator}</div>
                </div>
                = ?
            `;
            
            document.getElementById('answerArea').innerHTML = `
                <div class="answer-input-area">
                    <p style="margin-bottom: 20px; font-size: 1.2em;">Skriv ditt svar (f√∂rkortat):</p>
                    <div class="fraction-input">
                        <input type="number" id="answerNum" placeholder="0" min="0">
                        <div class="fraction-line"></div>
                        <input type="number" id="answerDen" placeholder="0" min="1">
                    </div>
                    <br><br>
                    <button class="btn" onclick="checkAddAnswer()">Svara</button>
                </div>
            `;
        }

        // Subtract challenge
        function generateSubtractChallenge() {
            let frac1 = generateFraction(7, 10);
            let frac2 = generateFraction(5, 10);
            
            // Ensure frac1 > frac2
            if (compareFractions(frac1, frac2) < 0) {
                [frac1, frac2] = [frac2, frac1];
            }
            
            // Calculate answer
            const commonDen = frac1.denominator * frac2.denominator / gcd(frac1.denominator, frac2.denominator);
            const num1 = frac1.numerator * (commonDen / frac1.denominator);
            const num2 = frac2.numerator * (commonDen / frac2.denominator);
            const resultNum = num1 - num2;
            
            const simplified = simplifyFraction(resultNum, commonDen);
            
            gameState.currentChallenge = {
                type: challengeTypes.SUBTRACT,
                frac1: frac1,
                frac2: frac2,
                correctAnswer: simplified
            };
            
            document.getElementById('challengeType').textContent = '‚ûñ Subtraktion';
            document.getElementById('challengeQuestion').innerHTML = `
                <div class="fraction">
                    <div class="numerator">${frac1.numerator}</div>
                    <div class="denominator">${frac1.denominator}</div>
                </div>
                ‚àí
                <div class="fraction">
                    <div class="numerator">${frac2.numerator}</div>
                    <div class="denominator">${frac2.denominator}</div>
                </div>
                = ?
            `;
            
            document.getElementById('answerArea').innerHTML = `
                <div class="answer-input-area">
                    <p style="margin-bottom: 20px; font-size: 1.2em;">Skriv ditt svar (f√∂rkortat):</p>
                    <div class="fraction-input">
                        <input type="number" id="answerNum" placeholder="0" min="0">
                        <div class="fraction-line"></div>
                        <input type="number" id="answerDen" placeholder="0" min="1">
                    </div>
                    <br><br>
                    <button class="btn" onclick="checkSubtractAnswer()">Svara</button>
                </div>
            `;
        }

        // Simplify challenge
        function generateSimplifyChallenge() {
            // Generate a fraction that can be simplified
            const factor = Math.floor(Math.random() * 4) + 2; // 2-5
            const simpleNum = Math.floor(Math.random() * 5) + 1;
            const simpleDen = Math.floor(Math.random() * 6) + 2;
            
            const complexNum = simpleNum * factor;
            const complexDen = simpleDen * factor;
            
            gameState.currentChallenge = {
                type: challengeTypes.SIMPLIFY,
                original: { numerator: complexNum, denominator: complexDen },
                correctAnswer: { numerator: simpleNum, denominator: simpleDen }
            };
            
            document.getElementById('challengeType').textContent = '‚ö° F√∂rkorta br√•k';
            document.getElementById('challengeQuestion').innerHTML = `
                F√∂rkorta detta br√•k:
                <div class="fraction">
                    <div class="numerator">${complexNum}</div>
                    <div class="denominator">${complexDen}</div>
                </div>
            `;
            
            document.getElementById('answerArea').innerHTML = `
                <div class="answer-input-area">
                    <p style="margin-bottom: 20px; font-size: 1.2em;">Skriv det f√∂rkortade br√•ket:</p>
                    <div class="fraction-input">
                        <input type="number" id="answerNum" placeholder="0" min="0">
                        <div class="fraction-line"></div>
                        <input type="number" id="answerDen" placeholder="0" min="1">
                    </div>
                    <br><br>
                    <button class="btn" onclick="checkSimplifyAnswer()">Svara</button>
                </div>
            `;
        }

        // Check compare answer
        function checkCompareAnswer(answer) {
            if (gameState.answered) return;
            
            gameState.answered = true;
            const correct = answer === gameState.currentChallenge.correctAnswer;
            
            // Visual feedback on buttons
            const buttons = document.querySelectorAll('.answer-btn');
            buttons.forEach((btn, index) => {
                const btnAnswer = index === 0 ? 'frac1' : 'frac2';
                if (btnAnswer === gameState.currentChallenge.correctAnswer) {
                    btn.classList.add('correct');
                } else if (btnAnswer === answer && !correct) {
                    btn.classList.add('incorrect');
                }
                btn.style.pointerEvents = 'none';
            });
            
            showFeedback(correct);
            updateScore(correct);
        }

        // Check add answer
        function checkAddAnswer() {
            if (gameState.answered) return;
            
            const numInput = parseInt(document.getElementById('answerNum').value);
            const denInput = parseInt(document.getElementById('answerDen').value);
            
            if (isNaN(numInput) || isNaN(denInput) || denInput === 0) {
                alert('Fyll i b√•de t√§ljare och n√§mnare!');
                return;
            }
            
            gameState.answered = true;
            
            const correct = numInput === gameState.currentChallenge.correctAnswer.numerator &&
                          denInput === gameState.currentChallenge.correctAnswer.denominator;
            
            showFeedback(correct, `R√§tt svar: ${gameState.currentChallenge.correctAnswer.numerator}/${gameState.currentChallenge.correctAnswer.denominator}`);
            updateScore(correct);
        }

        // Check subtract answer
        function checkSubtractAnswer() {
            if (gameState.answered) return;
            
            const numInput = parseInt(document.getElementById('answerNum').value);
            const denInput = parseInt(document.getElementById('answerDen').value);
            
            if (isNaN(numInput) || isNaN(denInput) || denInput === 0) {
                alert('Fyll i b√•de t√§ljare och n√§mnare!');
                return;
            }
            
            gameState.answered = true;
            
            const correct = numInput === gameState.currentChallenge.correctAnswer.numerator &&
                          denInput === gameState.currentChallenge.correctAnswer.denominator;
            
            showFeedback(correct, `R√§tt svar: ${gameState.currentChallenge.correctAnswer.numerator}/${gameState.currentChallenge.correctAnswer.denominator}`);
            updateScore(correct);
        }

        // Check simplify answer
        function checkSimplifyAnswer() {
            if (gameState.answered) return;
            
            const numInput = parseInt(document.getElementById('answerNum').value);
            const denInput = parseInt(document.getElementById('answerDen').value);
            
            if (isNaN(numInput) || isNaN(denInput) || denInput === 0) {
                alert('Fyll i b√•de t√§ljare och n√§mnare!');
                return;
            }
            
            gameState.answered = true;
            
            const correct = numInput === gameState.currentChallenge.correctAnswer.numerator &&
                          denInput === gameState.currentChallenge.correctAnswer.denominator;
            
            showFeedback(correct, `R√§tt svar: ${gameState.currentChallenge.correctAnswer.numerator}/${gameState.currentChallenge.correctAnswer.denominator}`);
            updateScore(correct);
        }

        // Show special card
        function showSpecialCard() {
            const bonusPoints = Math.random() < 0.5 ? 10 : 20;
            
            document.getElementById('specialCardArea').innerHTML = `
                <div class="special-card">
                    <h3>‚≠ê SPECIALKORT! ‚≠ê</h3>
                    <p>Svara r√§tt p√• denna fr√•ga och f√• ${bonusPoints} BONUSPO√ÑNG!</p>
                </div>
            `;
            
            gameState.specialCardActive = true;
            gameState.specialCardBonus = bonusPoints;
        }

        // Show feedback
        function showFeedback(correct, extraInfo = '') {
            const feedback = document.getElementById('feedback');
            const icon = document.getElementById('feedbackIcon');
            const text = document.getElementById('feedbackText');
            
            feedback.classList.remove('success', 'error');
            
            if (correct) {
                feedback.classList.add('success');
                icon.textContent = '‚úÖ';
                text.textContent = 'R√§tt svar! Bra jobbat!';
            } else {
                feedback.classList.add('error');
                icon.textContent = '‚ùå';
                text.innerHTML = `Fel svar. ${extraInfo}`;
            }
            
            feedback.classList.add('show');
            document.getElementById('nextBtn').style.display = 'block';
        }

        // Update score
        function updateScore(correct) {
            if (correct) {
                let points = 10;
                if (gameState.specialCardActive) {
                    points += gameState.specialCardBonus;
                    gameState.specialCardActive = false;
                }
                gameState.scores[gameState.currentPlayer] += points;
                updateScoreBoard();
                
                // Check for winner
                if (gameState.scores[gameState.currentPlayer] >= 50) {
                    setTimeout(showWinner, 1500);
                }
            }
        }

        // Update score board
        function updateScoreBoard() {
            const scoreBoard = document.getElementById('scoreBoard');
            if (gameState.numPlayers === 1) {
                scoreBoard.textContent = `Po√§ng: ${gameState.scores[0]}`;
            } else {
                scoreBoard.textContent = `Spelare 1: ${gameState.scores[0]}p | Spelare 2: ${gameState.scores[1]}p`;
            }
            
            updateCurrentPlayer();
        }

        // Update current player display
        function updateCurrentPlayer() {
            const currentPlayerDiv = document.getElementById('currentPlayer');
            if (gameState.numPlayers === 1) {
                currentPlayerDiv.textContent = 'Din tur!';
            } else {
                currentPlayerDiv.textContent = `Spelare ${gameState.currentPlayer + 1}:s tur`;
            }
        }

        // Next turn
        function nextTurn() {
            gameState.turnCount++;
            
            if (gameState.numPlayers === 2) {
                gameState.currentPlayer = 1 - gameState.currentPlayer;
            }
            
            generateChallenge();
        }

        // Show winner
        function showWinner() {
            const winnerText = document.getElementById('winnerText');
            const finalScore = document.getElementById('finalScore');
            
            if (gameState.numPlayers === 1) {
                winnerText.textContent = 'Grattis, du vann!';
                finalScore.textContent = `Slutpo√§ng: ${gameState.scores[0]} po√§ng`;
            } else {
                const winner = gameState.scores[0] > gameState.scores[1] ? 1 : 2;
                winnerText.textContent = `Spelare ${winner} vinner!`;
                finalScore.textContent = `Slutpo√§ng: ${gameState.scores[0]} - ${gameState.scores[1]}`;
            }
            
            showScreen('winnerScreen');
        }

        // Reset game
        function resetGame() {
            gameState = {
                numPlayers: 0,
                currentPlayer: 0,
                scores: [0, 0],
                currentChallenge: null,
                answered: false,
                turnCount: 0
            };
            
            // Reset player selection
            const buttons = document.querySelectorAll('.player-btn');
            buttons.forEach(btn => btn.classList.remove('selected'));
            document.getElementById('startBtn').style.display = 'none';
            
            showScreen('startScreen');
        }
    </script>
</body>
</html>
